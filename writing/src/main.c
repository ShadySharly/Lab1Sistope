/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////// DIRECTIVES /////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
# include <stdlib.h>
# include <stdio.h>
# include <unistd.h>
# include <string.h>

# include <sys/types.h>
# include <sys/wait.h>

# include "writing.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////// MAIN ////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// - INPUTS: - argv[1]: Numero de imagenes de entrada
//           - argv[2]: Bandera b 
// - OUTPUTS: - 
// - DESCRIPTION: Ejecuta la etapa de "writing" del pipeline, mostrando por consola los resultados y escribiendo las imagenes de salida con cada etapa
//                aplicada

int main(int argc, char** argv) {

    int i;
    char* number_images = argv[1];
    char* b = argv[2];

    if(b){
        printf("|   image   | nearly black |\n");
        printf("|-----------|--------------|\n");
    }

    for (i = 0; i < atoi(number_images); i++) {

        Image image;
        read(STDIN_FILENO, &image, sizeof(Image));
        
        //printImage (image);
        
        int number_image = i + 1;
        char output_file[20];
        char string_number[20];
        strcpy(output_file, "out_");
        sprintf(string_number, "%d", number_image);
        strcat(output_file, string_number);
        strcat(output_file, ".png");
        // writing
        //printf("salida: %s\n", output_file);

        if(atoi(b) == 1){

            if(image.nearly_black == 1){
                printf("|  imagen_%d |     yes      |\n",i+1);
            }
            else if(image.nearly_black == 0){
                printf("|  imagen_%d |      no      |\n",i+1);
            }
        }
        writing(image, output_file);
    }


    return 0;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////